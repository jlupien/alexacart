{% extends "base.html" %}

{% block title %}AlexaCart - Review Order{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Review Order</h1>
    <p>Session: {{ session_id[:8] }}</p>
</div>

<form id="review-form" hx-post="/order/commit" hx-target="#commit-section">
    <input type="hidden" name="session_id" value="{{ session_id }}">
    <table class="review-table">
        <thead>
            <tr>
                <th>Alexa Item</th>
                <th>Product</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in proposals %}
            {% include "partials/review_row.html" %}
            {% endfor %}
        </tbody>
    </table>

    <div class="commit-section" id="commit-section">
        {% set auto_count = proposals | selectattr('auto_committed') | list | length %}
        {% if auto_count == proposals | length %}
        <div class="status-message status-success">
            All {{ auto_count }} items were auto-added to cart during search!
        </div>
        <div style="display: flex; gap: 0.75rem;">
            <a href="https://www.instacart.com/store/{{ instacart_store | lower }}/storefront" target="_blank" class="btn btn-primary btn-lg">Review Cart on Instacart</a>
            <a href="/order/" class="btn btn-outline btn-lg">Start New Order</a>
        </div>
        {% elif auto_count > 0 %}
        <div style="margin-bottom: 0.75rem">
            <p class="muted">{{ auto_count }} item(s) already added during search.</p>
        </div>
        <button type="submit" id="commit-btn" class="btn btn-primary btn-lg">Add Remaining to Cart</button>
        {% else %}
        <button type="submit" id="commit-btn" class="btn btn-primary btn-lg">Add All to Cart</button>
        {% endif %}
    </div>
</form>
{% endblock %}
